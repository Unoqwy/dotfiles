- name: Setup dotfiles locally
  hosts: local

  vars_files:
    - ansible/vars/dirs.yml
    - ansible/vars/misc.yml
    - ansible/env_vars.yml

  pre_tasks:
  - name: Ensure elevation privileges are granted
    command: "whoami"
    changed_when: False
    become: yes
  - name: Ensure dotfiles destination directory exists
    file:
      path: "{{ install_dest }}"
      state: directory
  - name: Ensure XDG config directory exists
    file:
      path: "{{ install_dest }}/.config"
      state: directory
  - name: Ensure .local directory exists
    file:
      path: "{{ install_dest }}/.local"
      state: directory
  - name: Ensure .local/bin directory exists
    file:
      path: "{{ install_dest }}/.local/bin"
      state: directory

  - name: Install PARU helper
    kewlfft.aur.aur:
      name: paru
      use: makepkg
      state: present
    when: ansible_pkg_mgr == 'pacman'

  roles:
    - role: git
      tags: [base, git]
    - role: vim
      tags: [base, vim]
    - role: ssh
      tags: [base, ssh]

    - role: gittools
      tags: [workflow, gittools]
    - role: zsh
      tags: [workflow, shell]
    - role: tmux
      tags: [workflow, tmux]
    - role: nvim
      tags: [workflow, nvim]

    - role: x11
      tags: [desktop, x11]
    - role: qde
      tags: [desktop, qde]
    - role: xmonad
      tags: [desktop, xmonad]
    - role: kitty
      tags: [desktop, workflow, terminal, kitty]
    - role: alacritty
      tags: [desktop, terminal, alacritty]
    - role: wezterm
      tags: [desktop, terminal, wezterm]
    - role: udev-rules
      tags: [desktop, system, udev-rules]

    - role: rust
      tags: [lang, rust]
